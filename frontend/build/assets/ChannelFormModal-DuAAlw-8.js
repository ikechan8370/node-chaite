import{d as G,r as p,s as f,x,c as K,o as h,e as o,u as l,J as H,w as u,y as J,a as _,E as r,C as k,O as C,b as T,V as S,t as B,F as W,W as Q,H as X,n as Y,z as I,B as R,g as P,k as Z}from"./index-Dp1faHeH.js";import{_ as n}from"./FormItemGridItem-YEC3z4HO.js";import{N as ee}from"./DynamicTags-VCyQf17w.js";import{N as ae,a as le}from"./CollapseItem-BVnC3pah.js";import{N as q}from"./InputNumber-BxeR-3jl.js";import{_ as te}from"./FormItem-BFYeYoTE.js";import{N as F}from"./Grid-CqcXqV8U.js";import"./prop-BjyUHhTu.js";const oe={class:"ml-2 text-xs"},se={style:{display:"flex","justify-content":"flex-end","margin-top":"24px"}},ue=G({__name:"ChannelFormModal",props:{show:Boolean,editMode:Boolean,initialData:{type:Object,default:()=>({})},preProcessorOptions:{type:Array,default:()=>[]},postProcessorOptions:{type:Array,default:()=>[]}},emits:["update:show","submit"],setup(U,{emit:j}){const y=U,w=j,A=p(),v=f({get:()=>y.show,set:a=>w("update:show",a)}),O={name:{required:!0,trigger:["blur","input"],message:"请输入渠道名称"},adapterType:{required:!0,trigger:["blur","change"],message:"请选择客户端类型"},"options.baseUrl":{required:!0,trigger:["blur","input"],message:"请输入基础URL"}},t=p({adapterType:"openai",models:[],weight:1,priority:0,status:"enabled",options:{baseUrl:"",apiKey:"",multipleKeyStrategy:"random",proxy:"",preProcessorIds:[],postProcessorIds:[]},description:"",name:"",modelType:"settings"}),z=f(()=>{const a=Array.isArray(t.value.models)?t.value.models:[];if(a.length===0||new Set(a).size!==a.length)return"error"}),D=f(()=>{const a=Array.isArray(t.value.models)?t.value.models:[];return a.length===0?"请至少添加一个模型":new Set(a).size!==a.length?"模型名称不能重复":""}),g=p(!0),i=p([]),d=p(""),b=p(""),c=f({get:()=>t.value.status==="enabled",set:a=>M(a)});x(()=>y.initialData,a=>{y.editMode&&a&&(t.value={...a},i.value=[...a.models||[]],b.value=(a.models||[]).join(", "))},{immediate:!0});function M(a){t.value.status=a?"enabled":"disabled"}function N(a){t.value.models=[...a]}function E(){d.value.trim()&&(i.value.push(d.value.trim()),N(i.value),d.value="")}function L(a){const e=a.split(",").map(s=>s.trim()).filter(Boolean);t.value.models=e,i.value=e}function V(){A.value?.validate().then(a=>{if(Array.isArray(a)){console.error(a);return}w("submit",t.value),v.value=!1})}const m=p("");x(()=>t.value.options?.apiKey,a=>{Array.isArray(a)?m.value=a.join(`
`):m.value=a||""},{immediate:!0});function $(){t.value.options||(t.value.options={});const a=m.value.split(`
`).filter(e=>e.length>0);t.value.options.apiKey=a.length>1?a:a[0]||""}return f({get:()=>{const a=t.value.options?.apiKey;return Array.isArray(a)?a.join(`
`):a||""},set:a=>{t.value.options||(t.value.options={});const e=a.split(`
`).filter(s=>s.length>0);t.value.options.apiKey=e.length>1?e:e[0]||""}}),x(v,a=>{!a&&!y.editMode&&(t.value={adapterType:"openai",models:[],weight:1,priority:0,status:"enabled",options:{baseUrl:"",apiKey:"",multipleKeyStrategy:"random",proxy:"",preProcessorIds:[],postProcessorIds:[]},description:""},i.value=[],b.value="",d.value="")}),(a,e)=>(h(),K("div",null,[o(l(H),{show:v.value,"onUpdate:show":e[16]||(e[16]=s=>v.value=s),preset:"card",style:{width:"700px","max-width":"90vw"}},{default:u(()=>[o(l(J),{title:U.editMode?"编辑渠道":"添加渠道"},{default:u(()=>[o(l(te),{ref_key:"formRef",ref:A,rules:O,model:t.value},{default:u(()=>[o(l(F),{cols:24,"x-gap":12,"y-gap":16,responsive:"screen","item-responsive":""},{default:u(()=>[o(l(n),{span:"24 s:12 m:16",label:"名称",path:"name"},{default:u(()=>[o(l(r),{value:t.value.name,"onUpdate:value":e[0]||(e[0]=s=>t.value.name=s),placeholder:"请输入渠道名称"},null,8,["value"])]),_:1}),o(l(n),{span:"24 s:12 m:8",label:"适配器类型",path:"adapterType"},{default:u(()=>[o(l(k),{value:t.value.adapterType,"onUpdate:value":e[1]||(e[1]=s=>t.value.adapterType=s),options:[{label:"OpenAI",value:"openai"},{label:"Gemini",value:"gemini"},{label:"Claude",value:"claude"}],placeholder:"请选择适配器类型"},null,8,["value"])]),_:1}),o(l(n),{span:"24 s:12 m:16",label:"BaseURL",path:"options.baseUrl"},{default:u(()=>[o(l(r),{value:t.value.options.baseUrl,"onUpdate:value":e[2]||(e[2]=s=>t.value.options.baseUrl=s),placeholder:"请输入基础URL"},null,8,["value"])]),_:1}),o(l(n),{span:"24",label:"API密钥",path:"options.apiKey"},{default:u(()=>[o(l(r),{value:m.value,"onUpdate:value":e[3]||(e[3]=s=>m.value=s),type:"textarea",placeholder:"请输入API密钥，多个密钥请每行输入一个",onBlur:$},null,8,["value"])]),_:1}),o(l(n),{span:"24 s:12 m:8",label:"支持模型",path:"models","validation-status":z.value,feedback:D.value},{default:u(()=>[o(l(C),{vertical:""},{default:u(()=>[o(l(C),{align:"center",class:"mb-2"},{default:u(()=>[o(l(S),{value:g.value,"onUpdate:value":e[4]||(e[4]=s=>g.value=s),size:"small"},null,8,["value"]),_("span",oe,B(g.value?"标签模式":"文本模式"),1)]),_:1}),g.value?(h(),K(W,{key:0},[o(l(ee),{value:i.value,"onUpdate:value":[e[5]||(e[5]=s=>i.value=s),N]},null,8,["value"]),o(l(r),{value:d.value,"onUpdate:value":e[6]||(e[6]=s=>d.value=s),class:"mt-2",placeholder:"输入模型名称后按回车添加",onKeydown:Q(X(E,["prevent"]),["enter"])},null,8,["value","onKeydown"])],64)):(h(),T(l(r),{key:1,value:b.value,"onUpdate:value":[e[7]||(e[7]=s=>b.value=s),L],placeholder:"请输入支持的模型列表，以逗号分隔"},null,8,["value"]))]),_:1})]),_:1},8,["validation-status","feedback"])]),_:1}),o(l(ae),{class:"mt-4"},{default:u(()=>[o(l(le),{title:"高级设置",name:"advanced"},{default:u(()=>[o(l(F),{cols:24,"x-gap":12,"y-gap":16,responsive:"screen","item-responsive":""},{default:u(()=>[o(l(n),{span:"24 s:12 m:8",label:"状态",path:"status"},{default:u(()=>[o(l(I),{align:"center"},{default:u(()=>[o(l(S),{value:c.value,"onUpdate:value":[e[8]||(e[8]=s=>c.value=s),M]},null,8,["value"]),_("span",null,B(c.value?"启用":"禁用"),1)]),_:1})]),_:1}),o(l(n),{span:"24 s:12 m:8",label:"多密钥策略",path:"options.multipleKeyStrategy"},{default:u(()=>[o(l(k),{value:t.value.options.multipleKeyStrategy,"onUpdate:value":e[9]||(e[9]=s=>t.value.options.multipleKeyStrategy=s),options:[{label:"随机",value:"random"},{label:"轮询",value:"round-robin"},{label:"会话哈希",value:"conversation-hash"}],placeholder:"请选择多密钥策略"},null,8,["value"])]),_:1}),o(l(n),{span:"24 s:12 m:8",label:"代理",path:"options.proxy"},{default:u(()=>[o(l(r),{value:t.value.options.proxy,"onUpdate:value":e[10]||(e[10]=s=>t.value.options.proxy=s),placeholder:"请输入代理地址(可选)"},null,8,["value"])]),_:1}),o(l(n),{span:"24 s:12 m:8",label:"优先级",path:"priority"},{default:u(()=>[o(l(q),{value:t.value.priority,"onUpdate:value":e[11]||(e[11]=s=>t.value.priority=s)},null,8,["value"])]),_:1}),o(l(n),{span:"24 s:12 m:8",label:"权重",path:"weight"},{default:u(()=>[o(l(q),{value:t.value.weight,"onUpdate:value":e[12]||(e[12]=s=>t.value.weight=s)},null,8,["value"])]),_:1}),o(l(n),{span:"24",label:"描述",path:"description"},{default:u(()=>[o(l(r),{value:t.value.description,"onUpdate:value":e[13]||(e[13]=s=>t.value.description=s),type:"textarea",placeholder:"请输入渠道描述"},null,8,["value"])]),_:1}),c.value?Y("",!0):(h(),T(l(n),{key:0,span:"24",label:"禁用原因",path:"disabledReason"},{default:u(()=>[o(l(r),{value:t.value.disabledReason,"onUpdate:value":e[14]||(e[14]=s=>t.value.disabledReason=s),placeholder:"请输入禁用原因"},null,8,["value"])]),_:1}))]),_:1})]),_:1})]),_:1}),_("div",se,[o(l(I),null,{default:u(()=>[o(l(R),{onClick:e[15]||(e[15]=s=>v.value=!1)},{default:u(()=>e[17]||(e[17]=[P(" 取消 ")])),_:1,__:[17]}),o(l(R),{type:"primary",onClick:V},{default:u(()=>e[18]||(e[18]=[P(" 确定 ")])),_:1,__:[18]})]),_:1})])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])]))}}),ye=Z(ue,[["__scopeId","data-v-ca0ea02d"]]);export{ye as default};
