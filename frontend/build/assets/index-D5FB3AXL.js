import{_ as V,a as q}from"./add-one-C5dKyyWA.js";import{p as P,d as j,q as H,s as k,r as c,v as K,c as Q,o as W,e as n,w as o,y as X,u as l,z as Y,N as S,B as f,g as h,C as Z,D as ee,E as I,a as te,F as v,G as ne,k as oe}from"./index-DZraatOt.js";import{I as ae}from"./cloudy-Bh9hrQ25.js";import se from"./PresetFormModal-D3npe-gS.js";import{f as re}from"./processors-BCXorrgz.js";import{_ as le}from"./FormItem-CMLIekqh.js";import{N as ie,_ as ue,a as pe}from"./Grid-DbT1yFGD.js";import"./Checkbox-Dvhll5Gk.js";import"./prop-BjyUHhTu.js";import"./InputNumber-BwMZVu6O.js";import"./CollapseItem-DM5dDWEa.js";function ce(i){return P.Get("/api/preset/list",{params:i})}function de(i){return P.Post("/api/preset/",i)}function me(i){return P.Delete(`/api/preset/${i}`)}const _e={class:"flex gap-4"},fe=j({__name:"index",setup(i){function M({edit:t,remove:e}){return[{title:"ID",key:"id"},{title:"名称",key:"name",render(r){const _=[r.name];return r.uploader&&_.push(v(ne,{trigger:"hover"},{trigger:()=>v(ae,{style:{color:"green"}}),default:()=>"云端预设"})),v(S,{align:"center"},{default:()=>_})}},{title:"前缀",key:"prefix"},{title:"温度",key:"sendMessageOption.temperature"},{title:"上传者",key:"uploader"},{title:"更新日期",key:"updatedAt"},{title:"创建日期",key:"createdAt"},{title:"操作",key:"actions",render(r){return[v(f,{type:"info",strong:!0,tertiary:!0,size:"small",onClick:()=>t(r)},{default:()=>"修改"}),v(f,{type:"error",strong:!0,tertiary:!0,size:"small",onClick:()=>e(r)},{default:()=>"删除"})]}}]}const u=H(),N=k({value:[]}),w=k({value:{}}),s=c(!1),d=c(!1),g=c(!1),x={modelType:"settings",name:"",embedded:!1,description:"",sendMessageOption:{systemOverride:"",temperature:.6,model:""},prefix:"",channelId:"",local:!0},y=c(JSON.parse(JSON.stringify(x))),b=c([]),C=c([]),a=k({name:void 0,prompt:""});function m(t){s.value=!0,ce(t).then(e=>{N.value=e.data,s.value=!1}).catch(e=>{console.error(e),s.value=!1})}function z(){a.name=void 0,a.prompt="",m(a)}function B(){g.value=!1,y.value=JSON.parse(JSON.stringify(x)),d.value=!0}function G(t){g.value=!0,console.error(t),y.value={...t},d.value=!0}function F(t){window.$dialog.warning({title:"确认删除",content:`确定要删除预设 "${t.name}" 吗？此操作不可恢复。`,positiveText:"确认删除",negativeText:"取消",onPositiveClick:()=>{s.value=!0,me(t.id).then(e=>{e.code===0?(u.success("删除成功"),m(a)):u.error(e.message||"删除失败")}).catch(e=>{u.error(e.message||"删除操作发生错误")}).finally(()=>{s.value=!1})}})}function J(t){s.value=!0,de(t).then(e=>{e.code===0?(u.success(g.value?"更新成功":"创建成功"),m(a)):u.error(e.message),s.value=!1,d.value=!1}).catch(e=>{u.error(e.message),s.value=!1})}const T=M({edit(t){G(t)},remove(t){F(t)}});async function $(){try{const t=await re({});b.value=t.data.filter(e=>e.type==="pre").map(e=>({label:e.name,value:e.id})),C.value=t.data.filter(e=>e.type==="post").map(e=>({label:e.name,value:e.id}))}catch(t){console.error(t)}}return K(()=>{m(w.value),$()}),(t,e)=>{const r=Y,_=ue,A=Z,D=ee,E=pe,L=le,O=X,R=V,U=q;return W(),Q("div",null,[n(l(I),{vertical:"",size:"large"},{default:o(()=>[n(O,null,{default:o(()=>[n(L,{ref:"formRef",model:a,"label-placement":"left",inline:"","show-feedback":!1},{default:o(()=>[n(l(ie),{cols:"1 s:2 m:3 l:4","x-gap":12,"y-gap":16,responsive:"screen","item-responsive":""},{default:o(()=>[n(_,{span:"1",label:"名称",path:"name"},{default:o(()=>[n(r,{value:a.name,"onUpdate:value":e[0]||(e[0]=p=>a.name=p),placeholder:"请输入要搜索的名称关键词"},null,8,["value"])]),_:1}),n(_,{span:"1",label:"模型",path:"model"},{default:o(()=>[n(r,{value:a.prompt,"onUpdate:value":e[1]||(e[1]=p=>a.prompt=p),placeholder:"请输入要搜索的设定内容"},null,8,["value"])]),_:1}),n(E,{span:"1"},{default:o(()=>[n(l(S),{class:"ml-auto"},{default:o(()=>[n(l(f),{type:"primary",onClick:e[2]||(e[2]=p=>m(a))},{icon:o(()=>[n(A)]),default:o(()=>[e[4]||(e[4]=h(" 搜索 "))]),_:1}),n(l(f),{strong:"",secondary:"",onClick:z},{icon:o(()=>[n(D)]),default:o(()=>[e[5]||(e[5]=h(" 重置 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(O,null,{default:o(()=>[n(l(I),{vertical:"",size:"large"},{default:o(()=>[te("div",_e,[n(l(f),{type:"primary",onClick:B},{icon:o(()=>[n(R)]),default:o(()=>[e[6]||(e[6]=h(" 新建预设 "))]),_:1})]),n(U,{columns:l(T),data:N.value,loading:s.value},null,8,["columns","data","loading"])]),_:1})]),_:1})]),_:1}),n(se,{show:d.value,"onUpdate:show":e[3]||(e[3]=p=>d.value=p),"edit-mode":g.value,"initial-data":y.value,"pre-processor-options":b.value,"post-processor-options":C.value,onSubmit:J},null,8,["show","edit-mode","initial-data","pre-processor-options","post-processor-options"])])}}}),Se=oe(fe,[["__scopeId","data-v-ef7a17b8"]]);export{Se as default};
