import{_ as V,a as $}from"./add-one-Bf-qX7ie.js";import{d as D,q,s as y,r as p,v as j,c as H,o as K,e as o,w as n,y as Q,u as r,z as W,N as C,B as _,g as k,C as X,D as Y,E as O,a as Z,F as f,G as ee,k as te}from"./index-BdXsfUTR.js";import{I as oe}from"./cloudy-CKPr5gK8.js";import{f as ne,c as ae,d as se}from"./presets-CdzedJw4.js";import le from"./PresetFormModal-CDvELzVw.js";import{f as re}from"./processors-DmzRVTMm.js";import{_ as ie}from"./FormItem-DVIqIk7E.js";import{N as ue,_ as pe,a as ce}from"./Grid-BklvICAu.js";import"./Checkbox-eGJbp4no.js";import"./prop-BjyUHhTu.js";import"./InputNumber-C0v-Kouu.js";import"./CollapseItem-eYqP4Ri5.js";const de={class:"flex gap-4"},me=D({__name:"index",setup(_e){function S({edit:t,remove:e}){return[{title:"ID",key:"id"},{title:"名称",key:"name",render(l){const m=[l.name];return l.uploader&&m.push(f(ee,{trigger:"hover"},{trigger:()=>f(oe,{style:{color:"green"}}),default:()=>"云端预设"})),f(C,{align:"center"},{default:()=>m})}},{title:"前缀",key:"prefix"},{title:"温度",key:"sendMessageOption.temperature"},{title:"上传者",key:"uploader"},{title:"更新日期",key:"updatedAt"},{title:"创建日期",key:"createdAt"},{title:"操作",key:"actions",render(l){return[f(_,{type:"info",strong:!0,tertiary:!0,size:"small",onClick:()=>t(l)},{default:()=>"修改"}),f(_,{type:"error",strong:!0,tertiary:!0,size:"small",onClick:()=>e(l)},{default:()=>"删除"})]}}]}const i=q(),h=y({value:[]}),I=y({value:{}}),s=p(!1),c=p(!1),v=p(!1),P={modelType:"settings",name:"",embedded:!1,description:"",sendMessageOption:{systemOverride:"",temperature:.6,model:""},prefix:"",channelId:"",local:!0},g=p(JSON.parse(JSON.stringify(P))),N=p([]),x=p([]),a=y({name:void 0,prompt:""});function d(t){s.value=!0,ne(t).then(e=>{h.value=e.data,s.value=!1}).catch(e=>{console.error(e),s.value=!1})}function M(){a.name=void 0,a.prompt="",d(a)}function w(){v.value=!1,g.value=JSON.parse(JSON.stringify(P)),c.value=!0}function z(t){v.value=!0,console.error(t),g.value={...t},c.value=!0}function B(t){window.$dialog.warning({title:"确认删除",content:`确定要删除预设 "${t.name}" 吗？此操作不可恢复。`,positiveText:"确认删除",negativeText:"取消",onPositiveClick:()=>{s.value=!0,se(t.id).then(e=>{e.code===0?(i.success("删除成功"),d(a)):i.error(e.message||"删除失败")}).catch(e=>{i.error(e.message||"删除操作发生错误")}).finally(()=>{s.value=!1})}})}function F(t){s.value=!0,ae(t).then(e=>{e.code===0?(i.success(v.value?"更新成功":"创建成功"),d(a)):i.error(e.message),s.value=!1,c.value=!1}).catch(e=>{i.error(e.message),s.value=!1})}const G=S({edit(t){z(t)},remove(t){B(t)}});async function J(){try{const t=await re({});N.value=t.data.filter(e=>e.type==="pre").map(e=>({label:e.name,value:e.id})),x.value=t.data.filter(e=>e.type==="post").map(e=>({label:e.name,value:e.id}))}catch(t){console.error(t)}}return j(()=>{d(I.value),J()}),(t,e)=>{const l=W,m=pe,T=X,A=Y,E=ce,L=ie,b=Q,R=V,U=$;return K(),H("div",null,[o(r(O),{vertical:"",size:"large"},{default:n(()=>[o(b,null,{default:n(()=>[o(L,{ref:"formRef",model:a,"label-placement":"left",inline:"","show-feedback":!1},{default:n(()=>[o(r(ue),{cols:"1 s:2 m:3 l:4","x-gap":12,"y-gap":16,responsive:"screen","item-responsive":""},{default:n(()=>[o(m,{span:"1",label:"名称",path:"name"},{default:n(()=>[o(l,{value:a.name,"onUpdate:value":e[0]||(e[0]=u=>a.name=u),placeholder:"请输入要搜索的名称关键词"},null,8,["value"])]),_:1}),o(m,{span:"1",label:"模型",path:"model"},{default:n(()=>[o(l,{value:a.prompt,"onUpdate:value":e[1]||(e[1]=u=>a.prompt=u),placeholder:"请输入要搜索的设定内容"},null,8,["value"])]),_:1}),o(E,{span:"1"},{default:n(()=>[o(r(C),{class:"ml-auto"},{default:n(()=>[o(r(_),{type:"primary",onClick:e[2]||(e[2]=u=>d(a))},{icon:n(()=>[o(T)]),default:n(()=>[e[4]||(e[4]=k(" 搜索 "))]),_:1}),o(r(_),{strong:"",secondary:"",onClick:M},{icon:n(()=>[o(A)]),default:n(()=>[e[5]||(e[5]=k(" 重置 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(b,null,{default:n(()=>[o(r(O),{vertical:"",size:"large"},{default:n(()=>[Z("div",de,[o(r(_),{type:"primary",onClick:w},{icon:n(()=>[o(R)]),default:n(()=>[e[6]||(e[6]=k(" 新建预设 "))]),_:1})]),o(U,{columns:r(G),data:h.value,loading:s.value},null,8,["columns","data","loading"])]),_:1})]),_:1})]),_:1}),o(le,{show:c.value,"onUpdate:show":e[3]||(e[3]=u=>c.value=u),"edit-mode":v.value,"initial-data":g.value,"pre-processor-options":N.value,"post-processor-options":x.value,onSubmit:F},null,8,["show","edit-mode","initial-data","pre-processor-options","post-processor-options"])])}}}),Se=te(me,[["__scopeId","data-v-ef7a17b8"]]);export{Se as default};
