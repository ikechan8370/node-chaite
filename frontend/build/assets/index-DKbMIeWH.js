import{_ as D}from"./add-one-DlLPjlr1.js";import{d as Q,L as j,M as y,r as i,v as q,c as H,o as K,e as o,w as a,y as W,u as l,E as X,O,B as f,g as h,P as Y,Q as Z,z as M,a as ee,p as _,R as te,k as oe}from"./index-CTCg9uKL.js";import{I as ae}from"./cloudy-ChbmKke_.js";import{f as ne,c as se,a as re}from"./presets-BxcathDR.js";import le from"./PresetFormModal-Dm9W0PEY.js";import{f as ie}from"./processors-ZKukfrL-.js";import{f as ue}from"./toolGroup-DvldIIYd.js";import{_ as pe}from"./FormItem-V6nLMFD6.js";import{N as ce,_ as de}from"./Grid-DM-aCudj.js";import{_ as me}from"./FormItemGridItem-Cdarl9aB.js";import{N as fe}from"./DataTable-Dju8UbF0.js";import"./InputNumber-CkPYMNFf.js";import"./CollapseItem-DYdlmGyv.js";import"./Checkbox-DOSu9TCT.js";import"./Ellipsis-BX_jCex6.js";import"./prop-BjyUHhTu.js";import"./download-C2161hUv.js";const _e={class:"flex gap-4"},ve=Q({__name:"index",setup(ge){function S({edit:t,remove:e}){return[{title:"ID",key:"id"},{title:"名称",key:"name",render(s){const m=[s.name];return s.uploader&&m.push(_(te,{trigger:"hover"},{trigger:()=>_(ae,{style:{color:"green"}}),default:()=>"云端预设"})),_(O,{align:"center"},{default:()=>m})}},{title:"前缀",key:"prefix"},{title:"温度",key:"sendMessageOption.temperature"},{title:"上传者",key:"uploader"},{title:"更新日期",key:"updatedAt"},{title:"创建日期",key:"createdAt"},{title:"操作",key:"actions",render(s){return[_(f,{type:"info",strong:!0,tertiary:!0,size:"small",onClick:()=>t(s)},{default:()=>"修改"}),_(f,{type:"error",strong:!0,tertiary:!0,size:"small",onClick:()=>e(s)},{default:()=>"删除"})]}}]}const u=j(),k=y({value:[]}),I=y({value:{}}),r=i(!1),c=i(!1),v=i(!1),P={modelType:"settings",name:"",embedded:!1,description:"",sendMessageOption:{systemOverride:"",temperature:.6,model:""},prefix:"",channelId:"",local:!0},g=i(JSON.parse(JSON.stringify(P))),N=i([]),x=i([]),b=i([]),n=y({name:void 0,prompt:""});function d(t){r.value=!0,ne(t).then(e=>{k.value=e.data,r.value=!1}).catch(e=>{console.error(e),r.value=!1})}function w(){n.name=void 0,n.prompt="",d(n)}function T(){v.value=!1,g.value=JSON.parse(JSON.stringify(P)),c.value=!0}function z(t){v.value=!0,console.error(t),g.value={...t},c.value=!0}function B(t){window.$dialog.warning({title:"确认删除",content:`确定要删除预设 "${t.name}" 吗？此操作不可恢复。`,positiveText:"确认删除",negativeText:"取消",onPositiveClick:()=>{r.value=!0,re(t.id).then(e=>{e.code===0?(u.success("删除成功"),d(n)):u.error(e.message||"删除失败")}).catch(e=>{u.error(e.message||"删除操作发生错误")}).finally(()=>{r.value=!1})}})}function G(t){r.value=!0,se(t).then(e=>{e.code===0?(u.success(v.value?"更新成功":"创建成功"),d(n)):u.error(e.message),r.value=!1,c.value=!1}).catch(e=>{u.error(e.message),r.value=!1})}const L=S({edit(t){z(t)},remove(t){B(t)}});async function J(){try{const t=await ie({});N.value=t.data.filter(e=>e.type==="pre").map(e=>({label:e.name,value:e.id})),x.value=t.data.filter(e=>e.type==="post").map(e=>({label:e.name,value:e.id}))}catch(t){console.error(t)}}function R(t){ue(t).then(e=>{b.value=e.data.map(s=>({label:s.name,value:s.id}))})}return q(()=>{d(I.value),J(),R()}),(t,e)=>{const s=X,m=me,A=Y,E=Z,F=de,U=pe,C=W,V=D,$=fe;return K(),H("div",null,[o(l(M),{vertical:"",size:"large"},{default:a(()=>[o(C,null,{default:a(()=>[o(U,{ref:"formRef",model:n,"label-placement":"left",inline:"","show-feedback":!1},{default:a(()=>[o(l(ce),{cols:"1 s:2 m:3 l:4","x-gap":12,"y-gap":16,responsive:"screen","item-responsive":""},{default:a(()=>[o(m,{span:"1",label:"名称",path:"name"},{default:a(()=>[o(s,{value:n.name,"onUpdate:value":e[0]||(e[0]=p=>n.name=p),placeholder:"请输入要搜索的名称关键词"},null,8,["value"])]),_:1}),o(m,{span:"1",label:"模型",path:"model"},{default:a(()=>[o(s,{value:n.prompt,"onUpdate:value":e[1]||(e[1]=p=>n.prompt=p),placeholder:"请输入要搜索的设定内容"},null,8,["value"])]),_:1}),o(F,{span:"1"},{default:a(()=>[o(l(O),{class:"ml-auto"},{default:a(()=>[o(l(f),{type:"primary",onClick:e[2]||(e[2]=p=>d(n))},{icon:a(()=>[o(A)]),default:a(()=>[e[4]||(e[4]=h(" 搜索 "))]),_:1}),o(l(f),{strong:"",secondary:"",onClick:w},{icon:a(()=>[o(E)]),default:a(()=>[e[5]||(e[5]=h(" 重置 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(C,null,{default:a(()=>[o(l(M),{vertical:"",size:"large"},{default:a(()=>[ee("div",_e,[o(l(f),{type:"primary",onClick:T},{icon:a(()=>[o(V)]),default:a(()=>[e[6]||(e[6]=h(" 新建预设 "))]),_:1})]),o($,{columns:l(L),data:k.value,loading:r.value},null,8,["columns","data","loading"])]),_:1})]),_:1})]),_:1}),o(le,{show:c.value,"onUpdate:show":e[3]||(e[3]=p=>c.value=p),"edit-mode":v.value,"initial-data":g.value,"pre-processor-options":N.value,"post-processor-options":x.value,"tools-options":b.value,onSubmit:G},null,8,["show","edit-mode","initial-data","pre-processor-options","post-processor-options","tools-options"])])}}}),Le=oe(ve,[["__scopeId","data-v-6ab303e4"]]);export{Le as default};
