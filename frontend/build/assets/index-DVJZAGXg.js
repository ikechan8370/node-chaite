import{_ as D}from"./add-one-CTqCiftQ.js";import{d as Q,L as j,M as y,r as i,v as q,c as H,o as K,e as o,w as a,y as W,u as l,E as X,O as h,B as _,g as k,P as Y,Q as Z,z as M,a as ee,p as c,R as te,k as oe}from"./index-DJdQ0nV5.js";import{I as ae}from"./cloudy-MrNAszHw.js";import{f as ne,c as se,a as re}from"./presets-8ZEu20ZL.js";import le from"./PresetFormModal-BpleAL8Z.js";import{f as ie}from"./processors-CJsyXjR7.js";import{f as ue}from"./toolGroup-CvTMJceG.js";import{_ as pe}from"./FormItem-D5nKwNGe.js";import{N as ce,_ as de}from"./Grid-BNlPkf-g.js";import{_ as me}from"./FormItemGridItem-DaKl8_2L.js";import{N as fe}from"./DataTable-DoEbD9LL.js";import"./InputNumber-BjfLyebn.js";import"./Checkbox-BvK-NJJX.js";import"./CollapseItem-DOnuDO5j.js";import"./Ellipsis-C3lHtvjF.js";import"./prop-BjyUHhTu.js";import"./download-C2161hUv.js";const _e={class:"flex gap-4"},ve=Q({__name:"index",setup(ge){function S({edit:t,remove:e}){return[{title:"ID",key:"id"},{title:"名称",key:"name",render(n){const f=[n.name];return n.uploader&&f.push(c(te,{trigger:"hover"},{trigger:()=>c(ae,{style:{color:"green"}}),default:()=>"云端预设"})),c(h,{align:"center"},{default:()=>f})}},{title:"前缀",key:"prefix"},{title:"温度",key:"sendMessageOption.temperature"},{title:"上传者",key:"uploader",render(n){return c(h,{align:"center"},{default:()=>[n.uploader.username||`id (${n.uploader.user_id})`]})}},{title:"更新日期",key:"updatedAt"},{title:"创建日期",key:"createdAt"},{title:"操作",key:"actions",render(n){return[c(_,{type:"info",strong:!0,tertiary:!0,size:"small",onClick:()=>t(n)},{default:()=>"修改"}),c(_,{type:"error",strong:!0,tertiary:!0,size:"small",onClick:()=>e(n)},{default:()=>"删除"})]}}]}const u=j(),P=y({value:[]}),I=y({value:{}}),r=i(!1),d=i(!1),v=i(!1),N={modelType:"settings",name:"",embedded:!1,description:"",sendMessageOption:{systemOverride:"",temperature:.6,model:""},prefix:"",channelId:"",local:!0},g=i(JSON.parse(JSON.stringify(N))),x=i([]),b=i([]),C=i([]),s=y({name:void 0,prompt:""});function m(t){r.value=!0,ne(t).then(e=>{P.value=e.data,r.value=!1}).catch(e=>{console.error(e),r.value=!1})}function T(){s.name=void 0,s.prompt="",m(s)}function w(){v.value=!1,g.value=JSON.parse(JSON.stringify(N)),d.value=!0}function z(t){v.value=!0,console.error(t),g.value={...t},d.value=!0}function B(t){window.$dialog.warning({title:"确认删除",content:`确定要删除预设 "${t.name}" 吗？此操作不可恢复。`,positiveText:"确认删除",negativeText:"取消",onPositiveClick:()=>{r.value=!0,re(t.id).then(e=>{e.code===0?(u.success("删除成功"),m(s)):u.error(e.message||"删除失败")}).catch(e=>{u.error(e.message||"删除操作发生错误")}).finally(()=>{r.value=!1})}})}function G(t){r.value=!0,se(t).then(e=>{e.code===0?(u.success(v.value?"更新成功":"创建成功"),m(s)):u.error(e.message),r.value=!1,d.value=!1}).catch(e=>{u.error(e.message),r.value=!1})}const L=S({edit(t){z(t)},remove(t){B(t)}});async function J(){try{const t=await ie({});x.value=t.data.filter(e=>e.type==="pre").map(e=>({label:e.name,value:e.id})),b.value=t.data.filter(e=>e.type==="post").map(e=>({label:e.name,value:e.id}))}catch(t){console.error(t)}}function R(t){ue(t).then(e=>{C.value=e.data.map(n=>({label:n.name,value:n.id}))})}return q(()=>{m(I.value),J(),R()}),(t,e)=>{const n=X,f=me,$=Y,A=Z,E=de,F=pe,O=W,U=D,V=fe;return K(),H("div",null,[o(l(M),{vertical:"",size:"large"},{default:a(()=>[o(O,null,{default:a(()=>[o(F,{ref:"formRef",model:s,"label-placement":"left",inline:"","show-feedback":!1},{default:a(()=>[o(l(ce),{cols:"1 s:2 m:3 l:4","x-gap":12,"y-gap":16,responsive:"screen","item-responsive":""},{default:a(()=>[o(f,{span:"1",label:"名称",path:"name"},{default:a(()=>[o(n,{value:s.name,"onUpdate:value":e[0]||(e[0]=p=>s.name=p),placeholder:"请输入要搜索的名称关键词"},null,8,["value"])]),_:1}),o(f,{span:"1",label:"模型",path:"model"},{default:a(()=>[o(n,{value:s.prompt,"onUpdate:value":e[1]||(e[1]=p=>s.prompt=p),placeholder:"请输入要搜索的设定内容"},null,8,["value"])]),_:1}),o(E,{span:"1"},{default:a(()=>[o(l(h),{class:"ml-auto"},{default:a(()=>[o(l(_),{type:"primary",onClick:e[2]||(e[2]=p=>m(s))},{icon:a(()=>[o($)]),default:a(()=>[e[4]||(e[4]=k(" 搜索 "))]),_:1}),o(l(_),{strong:"",secondary:"",onClick:T},{icon:a(()=>[o(A)]),default:a(()=>[e[5]||(e[5]=k(" 重置 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(O,null,{default:a(()=>[o(l(M),{vertical:"",size:"large"},{default:a(()=>[ee("div",_e,[o(l(_),{type:"primary",onClick:w},{icon:a(()=>[o(U)]),default:a(()=>[e[6]||(e[6]=k(" 新建预设 "))]),_:1})]),o(V,{columns:l(L),data:P.value,loading:r.value},null,8,["columns","data","loading"])]),_:1})]),_:1})]),_:1}),o(le,{show:d.value,"onUpdate:show":e[3]||(e[3]=p=>d.value=p),"edit-mode":v.value,"initial-data":g.value,"pre-processor-options":x.value,"post-processor-options":b.value,"tools-options":C.value,onSubmit:G},null,8,["show","edit-mode","initial-data","pre-processor-options","post-processor-options","tools-options"])])}}}),Le=oe(ve,[["__scopeId","data-v-f5bcd20c"]]);export{Le as default};
