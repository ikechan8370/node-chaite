import{_ as V}from"./add-one-DdEKtC9E.js";import{p as P,d as q,q as j,s as k,r as c,v as H,c as K,o as Q,e as o,w as n,y as W,u as l,z as X,N as S,B as f,g as h,C as Y,D as Z,E as I,a as ee,F as v,G as te,k as oe}from"./index-CucaxZT9.js";import{I as ne}from"./cloudy-6VZ1gCSH.js";import ae from"./PresetFormModal-DxcaSM29.js";import{f as se}from"./processors-VrlS2K8K.js";import{_ as re}from"./FormItem-Dc6zS2Y0.js";import{N as le,_ as ie}from"./Grid-KISfveeX.js";import{_ as ue}from"./FormItemGridItem-Dp7BRbUe.js";import{_ as pe}from"./DataTable-DNEbLQCY.js";import"./InputNumber-cu9bhpU_.js";import"./CollapseItem-Dfyd-2UU.js";import"./Checkbox-D1L79b_W.js";import"./Radio-RTfkllD3.js";import"./RadioGroup-B2AZpoS6.js";import"./Ellipsis-BisKcmIj.js";import"./Pagination-DRiwVTMo.js";import"./prop-BjyUHhTu.js";function ce(i){return P.Get("/api/preset/list",{params:i})}function de(i){return P.Post("/api/preset/",i)}function me(i){return P.Delete(`/api/preset/${i}`)}const _e={class:"flex gap-4"},fe=q({__name:"index",setup(i){function M({edit:t,remove:e}){return[{title:"ID",key:"id"},{title:"名称",key:"name",render(r){const _=[r.name];return r.uploader&&_.push(v(te,{trigger:"hover"},{trigger:()=>v(ne,{style:{color:"green"}}),default:()=>"云端预设"})),v(S,{align:"center"},{default:()=>_})}},{title:"前缀",key:"prefix"},{title:"温度",key:"sendMessageOption.temperature"},{title:"上传者",key:"uploader"},{title:"更新日期",key:"updatedAt"},{title:"创建日期",key:"createdAt"},{title:"操作",key:"actions",render(r){return[v(f,{type:"info",strong:!0,tertiary:!0,size:"small",onClick:()=>t(r)},{default:()=>"修改"}),v(f,{type:"error",strong:!0,tertiary:!0,size:"small",onClick:()=>e(r)},{default:()=>"删除"})]}}]}const u=j(),N=k({value:[]}),w=k({value:{}}),s=c(!1),d=c(!1),g=c(!1),x={modelType:"settings",name:"",embedded:!1,description:"",sendMessageOption:{systemOverride:"",temperature:.6,model:""},prefix:"",channelId:"",local:!0},y=c(JSON.parse(JSON.stringify(x))),b=c([]),C=c([]),a=k({name:void 0,prompt:""});function m(t){s.value=!0,ce(t).then(e=>{N.value=e.data,s.value=!1}).catch(e=>{console.error(e),s.value=!1})}function z(){a.name=void 0,a.prompt="",m(a)}function B(){g.value=!1,y.value=JSON.parse(JSON.stringify(x)),d.value=!0}function G(t){g.value=!0,console.error(t),y.value={...t},d.value=!0}function F(t){window.$dialog.warning({title:"确认删除",content:`确定要删除预设 "${t.name}" 吗？此操作不可恢复。`,positiveText:"确认删除",negativeText:"取消",onPositiveClick:()=>{s.value=!0,me(t.id).then(e=>{e.code===0?(u.success("删除成功"),m(a)):u.error(e.message||"删除失败")}).catch(e=>{u.error(e.message||"删除操作发生错误")}).finally(()=>{s.value=!1})}})}function J(t){s.value=!0,de(t).then(e=>{e.code===0?(u.success(g.value?"更新成功":"创建成功"),m(a)):u.error(e.message),s.value=!1,d.value=!1}).catch(e=>{u.error(e.message),s.value=!1})}const T=M({edit(t){G(t)},remove(t){F(t)}});async function $(){try{const t=await se({});b.value=t.data.filter(e=>e.type==="pre").map(e=>({label:e.name,value:e.id})),C.value=t.data.filter(e=>e.type==="post").map(e=>({label:e.name,value:e.id}))}catch(t){console.error(t)}}return H(()=>{m(w.value),$()}),(t,e)=>{const r=X,_=ue,A=Y,D=Z,E=ie,L=re,O=W,R=V,U=pe;return Q(),K("div",null,[o(l(I),{vertical:"",size:"large"},{default:n(()=>[o(O,null,{default:n(()=>[o(L,{ref:"formRef",model:a,"label-placement":"left",inline:"","show-feedback":!1},{default:n(()=>[o(l(le),{cols:"1 s:2 m:3 l:4","x-gap":12,"y-gap":16,responsive:"screen","item-responsive":""},{default:n(()=>[o(_,{span:"1",label:"名称",path:"name"},{default:n(()=>[o(r,{value:a.name,"onUpdate:value":e[0]||(e[0]=p=>a.name=p),placeholder:"请输入要搜索的名称关键词"},null,8,["value"])]),_:1}),o(_,{span:"1",label:"模型",path:"model"},{default:n(()=>[o(r,{value:a.prompt,"onUpdate:value":e[1]||(e[1]=p=>a.prompt=p),placeholder:"请输入要搜索的设定内容"},null,8,["value"])]),_:1}),o(E,{span:"1"},{default:n(()=>[o(l(S),{class:"ml-auto"},{default:n(()=>[o(l(f),{type:"primary",onClick:e[2]||(e[2]=p=>m(a))},{icon:n(()=>[o(A)]),default:n(()=>[e[4]||(e[4]=h(" 搜索 "))]),_:1}),o(l(f),{strong:"",secondary:"",onClick:z},{icon:n(()=>[o(D)]),default:n(()=>[e[5]||(e[5]=h(" 重置 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(O,null,{default:n(()=>[o(l(I),{vertical:"",size:"large"},{default:n(()=>[ee("div",_e,[o(l(f),{type:"primary",onClick:B},{icon:n(()=>[o(R)]),default:n(()=>[e[6]||(e[6]=h(" 新建预设 "))]),_:1})]),o(U,{columns:l(T),data:N.value,loading:s.value},null,8,["columns","data","loading"])]),_:1})]),_:1})]),_:1}),o(ae,{show:d.value,"onUpdate:show":e[3]||(e[3]=p=>d.value=p),"edit-mode":g.value,"initial-data":y.value,"pre-processor-options":b.value,"post-processor-options":C.value,onSubmit:J},null,8,["show","edit-mode","initial-data","pre-processor-options","post-processor-options"])])}}}),Ge=oe(fe,[["__scopeId","data-v-ef7a17b8"]]);export{Ge as default};
